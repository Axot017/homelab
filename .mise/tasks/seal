#!/usr/bin/env bash

#USAGE arg "<path>" help="Path to the Kubernetes secret YAML file to be sealed"

set -euo pipefail

input="${usage_path?}"

if [[ ! -f "$input" ]]; then
    echo "Error: File '$input' not found"
    exit 1
fi

# Generate output filename: *secret.yaml -> *sealed-secret.yaml
output="${input/secret.yaml/sealed-secret.yaml}"

if [[ "$input" == "$output" ]]; then
    echo "Error: Input file must end with 'secret.yaml'"
    exit 1
fi

echo "Sealing: $input -> $output"

kubeseal \
    --controller-name=sealed-secrets-controller \
    --controller-namespace=kube-system \
    --format=yaml \
    < "$input" \
    > "$output"

echo "âœ“ Sealed secret created: $output"
echo ""
echo "Remember: Don't commit $input (should be in .gitignore)"
